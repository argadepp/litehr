import{s as re,t as P,r as _,o as r,k as y,l as s,d as n,f as d,e as u,u as W,m as X,h as Y,q as Z,I as Q,v as ee,j as te,x as B,y as b,p as H,n as K,a as x,b as L,w as S,g as de,z as G,A as ue,F as ce}from"./app-44623493.js";import{d as J}from"./vuedraggable.umd-baf2a55c.js";const me={pageItems:[],items:[],all:!1,global:!1};function pe(D){return!!D.pageItems.every(m=>D.items.includes(m))}function fe(D,m){return m.pageItems.forEach(f=>{D&&!m.items.includes(f)?m.items.push(f):D||m.items.splice(m.items.indexOf(f),1)}),m.items}const ge={class:"grid grid-cols-1"},_e={class:"col-span-1"},he={name:"UtilityTodoListForm"},ye=Object.assign(he,{emits:["completed"],setup(D,{emit:m}){const f={name:""},v="utility/todo/",g=re(v),T=P({...f}),h=c=>{m("completed",c)};return(c,q)=>{const F=_("BaseInput"),w=_("FormAction");return r(),y(w,{"no-card":!0,"init-url":v,"init-form":f,action:"addList",form:T,"keep-adding":!1,"after-submit":h},{default:s(()=>[n("div",ge,[n("div",_e,[d(F,{type:"text",modelValue:T.name,"onUpdate:modelValue":q[0]||(q[0]=a=>T.name=a),name:"name",placeholder:c.$trans("utility.todo.list.props.name"),error:u(g).name,"onUpdate:error":q[1]||(q[1]=a=>u(g).name=a)},null,8,["modelValue","placeholder","error"])])])]),_:1},8,["form"])}}}),ve={class:"flex h-[calc(100vh_-_250px)] w-80 flex-shrink-0 flex-col rounded-md bg-gray-100 p-3 dark:bg-neutral-800"},ke={class:"scroller-thin-y scroller-hidden min-h-0 flex-1"},be={key:0,class:"mt-2 rounded-md border-2 border-dashed border-gray-400 p-2 text-sm text-gray-400 dark:border-gray-500 dark:text-gray-500"},$e={class:"space-y-2 p-3"},we=["onClick"],Ce={class:"flex justify-between text-xs"},Ae={class:"space-x-2"},Ue={class:"cursor-move"},Ie=n("i",{class:"fas fa-arrows-up-down-left-right text-gray-400 dark:text-gray-900"},null,-1),Be=[Ie],Le={key:0,class:"font-medium"},qe=n("i",{class:"far fa-clock"},null,-1),Ve={key:1},De=n("i",{class:"far fa-clock"},null,-1),Te={class:"space-x-2"},xe={key:0},Fe=["onClick"],Se={key:1},Oe=["onClick"],Re={key:2},Pe=["onClick"],je={key:3},ze=["onClick"],Ee={name:"UtilityTodoListBoardView"},He=Object.assign(Ee,{props:{todos:{type:Object,default(){return{data:[]}}},preRequisites:{type:Object,default:()=>({})},isLoading:{type:Boolean,default:!1}},emits:["newListAdded"],setup(D,{emit:m}){const f=D;W();const v=X(),g=Y(),T=Z("emitter"),h=P({lists:[],emptyList:[]}),c=()=>{h.lists=[];let t=[{name:"Uncategorized",uuid:"uncategorized",items:[]}];f.preRequisites.todoLists.forEach(p=>{t.push({name:p.name,uuid:p.uuid,items:[]})}),f.todos.data.forEach(p=>{var A;if((A=p.list)!=null&&A.uuid){let k=t.find(U=>U.name==p.list.name);k?k.items.push(p):t.push({name:p.list.name,uuid:p.list.uuid,items:[p]})}else t.find(k=>k.name==="Uncategorized").items.push(p)}),t.find(p=>p.name==="Uncategorized").items.length===0&&(t=t.filter(p=>p.name!=="Uncategorized")),h.lists=t},q=t=>{let p=h.lists.map(A=>A.uuid);g.dispatch("utility/todo/reorderList",{uuids:p}).then(A=>{}).catch(A=>{})},F=t=>{var A,k;let p=0;if(t.removed&&(p=t.removed.oldIndex),t.added){let U=t.added.element.uuid,l=(A=t.added.element.list)==null?void 0:A.uuid,e=null,i=[];h.lists.forEach(I=>{I.items.find(O=>O.uuid===U)&&(e=I.uuid,i=I.items.map(O=>O.uuid))}),g.dispatch("utility/todo/moveList",{uuid:U,listUuid:e,itemUuids:i}).then(I=>{}).catch(I=>{l===void 0&&(l="uncategorized"),h.lists.find(V=>V.uuid===l).items.splice(p,0,t.added.element);let E=h.lists.find(V=>V.uuid===e);E.items=E.items.filter(V=>V.uuid!==U)})}if(t.moved){t.moved.element.uuid;let U=((k=t.moved.element.list)==null?void 0:k.uuid)||"uncategorized",e=h.lists.find(i=>i.uuid===U).items.map(i=>i.uuid);g.dispatch("utility/todo/reorderItems",{uuids:e}).then(i=>{}).catch(i=>{})}},w=t=>{m("newListAdded",t.option),h.lists.push({name:t.option.name,uuid:t.option.uuid,items:[]})},a=async t=>{T.emit("actionItem",{uuid:t.uuid,action:"status",confirmation:!0})},z=async t=>{T.emit("actionItem",{uuid:t.uuid,action:"archive",confirmation:!0})},$=async t=>{T.emit("actionItem",{uuid:t.uuid,action:"unarchive",confirmation:!0})};return Q(()=>f.todos,t=>{c()},{deep:!0}),ee(()=>{c()}),(t,p)=>{const A=_("KanBanView"),k=te("tooltip");return r(),y(A,{"add-list":!!u(H)("utility:config")},{addListTitle:s(()=>[B(b(t.$trans("global.add",{attribute:t.$trans("utility.todo.list.list")})),1)]),addListForm:s(()=>[d(ye,{onCompleted:w})]),default:s(()=>[d(u(J),{class:"flex space-x-2",list:h.lists,onChange:q,"item-key":"uuid",disabled:!u(H)("utility:config")},{item:s(({element:U})=>[n("div",ve,[n("h3",{class:K(["pb-2 text-sm font-medium text-gray-900 dark:text-gray-300",{"cursor-move":!!u(H)("utility:config")}])},b(U.name),3),n("div",ke,[d(u(J),{class:"mt-2 space-y-3",list:U.items,group:"items",onChange:F,"item-key":"uuid"},{header:s(()=>[U.items.length===0?(r(),x("div",be,b(t.$trans("utility.todo.list.info_empty")),1)):L("",!0)]),item:s(({element:l})=>[n("div",{class:K(["dark:bg-dark-body rounded-md border-2 bg-white text-gray-700 shadow-sm dark:text-gray-400",{"border-success":l.completedAt,"border-danger":l.isOverdue,"border-warning":l.isDueToday,"border-gray-400":!l.completedAt&&!l.isOverdue&&!l.isDueToday}])},[n("div",$e,[n("p",{class:"cursor-pointer text-sm",onClick:e=>u(v).push({name:"UtilityTodoShow",params:{uuid:l.uuid}})},b(l.title),9,we),n("div",Ce,[n("div",Ae,[S((r(),x("span",Ue,Be)),[[k,t.$trans("general.move")]]),l.isOverdue?S((r(),x("span",Le,[qe,B(" "+b(l.due.formatted),1)])),[[k,l.overdueDaysDisplay]]):(r(),x("span",Ve,[De,B(" "+b(l.due.formatted),1)]))]),n("span",Te,[l.completedAt?S((r(),x("span",xe,[n("i",{class:"far fa-times-circle fa-lg text-danger cursor-pointer",onClick:e=>a(l)},null,8,Fe)])),[[k,t.$trans("utility.todo.mark_as_incomplete")]]):S((r(),x("span",Se,[n("i",{class:"far fa-check-circle fa-lg text-success cursor-pointer",onClick:e=>a(l)},null,8,Oe)])),[[k,t.$trans("utility.todo.mark_as_complete")]]),l.completedAt&&!l.isArchived?S((r(),x("span",Re,[n("i",{class:"fas fa-box-archive cursor-pointer text-gray-400",onClick:e=>z(l)},null,8,Pe)])),[[k,t.$trans("general.archive")]]):L("",!0),l.isArchived?S((r(),x("span",je,[n("i",{class:"fas fa-box-open cursor-pointer text-gray-400",onClick:e=>$(l)},null,8,ze)])),[[k,t.$trans("general.unarchive")]]):L("",!0)])])])],2)]),_:2},1032,["list"])])])]),_:1},8,["list","disabled"])]),_:1},8,["add-list"])}}}),Me={class:"grid grid-cols-3 gap-6"},Ne={class:"col-span-3 sm:col-span-1"},Ke={class:"col-span-3 sm:col-span-1"},Ge={class:"col-span-3 sm:col-span-1"},Je={class:"col-span-3 sm:col-span-1"},We={__name:"Filter",props:{preRequisites:{type:Object,default(){return{}}}},emits:["hide"],setup(D,{emit:m}){const f=D,v={search:"",startDate:"",endDate:"",status:"",isArchived:!1},g=P({...v}),T=P({statuses:f.preRequisites.statuses});return(h,c)=>{const q=_("BaseInput"),F=_("DatePicker"),w=_("BaseSelect"),a=_("BaseSwitch"),z=_("FilterForm");return r(),y(z,{"init-form":v,form:g,onHide:c[5]||(c[5]=$=>m("hide"))},{default:s(()=>[n("div",Me,[n("div",Ne,[d(q,{type:"text",modelValue:g.search,"onUpdate:modelValue":c[0]||(c[0]=$=>g.search=$),name:"search",label:h.$trans("general.search")},null,8,["modelValue","label"])]),n("div",Ke,[d(F,{start:g.startDate,"onUpdate:start":c[1]||(c[1]=$=>g.startDate=$),end:g.endDate,"onUpdate:end":c[2]||(c[2]=$=>g.endDate=$),name:"dateBetween",as:"range",label:h.$trans("general.date_between")},null,8,["start","end","label"])]),n("div",Ge,[d(w,{modelValue:g.status,"onUpdate:modelValue":c[3]||(c[3]=$=>g.status=$),name:"status",label:h.$trans("utility.todo.status"),options:T.statuses},null,8,["modelValue","label","options"])]),n("div",Je,[d(a,{vertical:"",modelValue:g.isArchived,"onUpdate:modelValue":c[4]||(c[4]=$=>g.isArchived=$),name:"isArchived",label:h.$trans("general.archived")},null,8,["modelValue","label"])])])]),_:1},8,["form"])}}},Xe=n("i",{class:"fas fa-cog"},null,-1),Ye=n("i",{class:"fas fa-list"},null,-1),Ze=n("i",{class:"fas fa-table"},null,-1),Qe={class:"space-x-1"},et={key:0},tt=["onClick"],st={key:1},it=["onClick"],at={name:"UilityTodoList"},lt=Object.assign(at,{setup(D){const m=W(),f=X();Y();const v=Z("emitter");let g=[];H("task:export")&&(g=["print","pdf","excel"]);const T=de("utility.todoView"),h="utility/todo/",c=P({statuses:[],todoLists:[]}),q=G(!1),F=G(!1),w=P({data:[]}),a=P({...me}),z=e=>{Object.assign(w,e),a.items=[],a.pageItems=w.data.map(i=>i.uuid),q.value=!1},$=async e=>{v.emit("actionItem",{uuid:e.uuid,action:"status",confirmation:!0})},t=async e=>{v.emit("actionItem",{uuid:e.uuid,action:"archive",confirmation:!0})},p=async e=>{v.emit("actionItem",{uuid:e.uuid,action:"unarchive",confirmation:!0})},A=e=>{Object.assign(c,e)},k=e=>{e=="delete"&&v.emit("deleteItems",{global:a.global,uuids:a.items})},U=e=>{c.todoLists.push(e)},l=()=>{m.name=="UtilityTodoList"&&(!m.query.view||m.query.view===void 0)&&f.push({query:{view:T.value}})};return Q(()=>[a.items,a.pageItems,m.query.view],([e,i,I],[O,E,V])=>{I!=V?(l(),I&&V!==void 0&&v.emit("listItems")):a.all=pe(a)}),ee(()=>{q.value=!0,l()}),(e,i)=>{const I=_("BaseButton"),O=_("PageHeaderAction"),E=_("PageHeader"),V=_("ParentTransition"),se=_("BaseArrayCheckbox"),ie=_("BaseCheckbox"),R=_("DataCell"),N=_("BaseBadge"),j=_("FloatingMenuItem"),ae=_("FloatingMenu"),oe=_("DataRow"),ne=_("DataTable"),le=_("ListItem"),M=te("tooltip");return r(),y(le,{"init-url":h,"pre-requisites":!0,onSetPreRequisites:A,onSetItems:z},{header:s(()=>[d(E,{title:e.$trans("utility.todo.todo")},{default:s(()=>[d(O,{url:"utility/todos/",name:"UtilityTodo",title:e.$trans("utility.todo.todo"),actions:["create","filter"],"bulk-actions":[{name:"delete",label:e.$trans("general.delete"),icon:"fas fa-trash"}],"show-bulk-action":a.items.length>0||a.global,"dropdown-actions":u(g),headers:w.headers,onToggleFilter:i[3]||(i[3]=o=>F.value=!F.value),onOnBulkAction:k},{after:s(()=>[u(H)("utility:config")?(r(),y(I,{key:0,design:"white",onClick:i[0]||(i[0]=o=>u(f).push({name:"UtilityConfig"}))},{default:s(()=>[Xe]),_:1})):L("",!0),u(m).query.view!="list"?S((r(),y(I,{key:1,design:"white",onClick:i[1]||(i[1]=o=>u(f).push({query:{view:"list"}}))},{default:s(()=>[Ye]),_:1})),[[M,e.$trans("global._view",{attribute:e.$trans("general.views.list")})]]):L("",!0),u(m).query.view!="board"?S((r(),y(I,{key:2,design:"white",onClick:i[2]||(i[2]=o=>u(f).push({query:{view:"board"}}))},{default:s(()=>[Ze]),_:1})),[[M,e.$trans("global._view",{attribute:e.$trans("general.views.board")})]]):L("",!0)]),_:1},8,["title","bulk-actions","show-bulk-action","dropdown-actions","headers"])]),_:1},8,["title"])]),filter:s(()=>[d(V,{appear:"",visibility:F.value},{default:s(()=>[d(We,{onRefresh:i[4]||(i[4]=o=>u(v).emit("listItems")),"pre-requisites":c,onHide:i[5]||(i[5]=o=>F.value=!1)},null,8,["pre-requisites"])]),_:1},8,["visibility"])]),default:s(()=>[u(m).query.view=="list"?(r(),y(V,{key:0,appear:"",visibility:!0},{default:s(()=>[d(ne,{onToggleSelectAll:i[9]||(i[9]=o=>a.items=u(fe)(o,a)),onToggleGlobalSelect:i[10]||(i[10]=o=>a.global=!a.global),selected:a,header:w.headers,meta:w.meta,module:"utility.todo",onRefresh:i[11]||(i[11]=o=>u(v).emit("listItems"))},{actionButton:s(()=>[d(I,{onClick:i[8]||(i[8]=o=>u(f).push({name:"UtilityTodoCreate"}))},{default:s(()=>[B(b(e.$trans("global.add",{attribute:e.$trans("utility.todo.todo")})),1)]),_:1})]),default:s(()=>[(r(!0),x(ce,null,ue(w.data,o=>(r(),y(oe,{key:o.uuid},{default:s(()=>[d(R,{name:"selectAll"},{default:s(()=>[a.global?L("",!0):(r(),y(se,{key:0,items:a.items,"onUpdate:items":i[6]||(i[6]=C=>a.items=C),value:o.uuid},null,8,["items","value"])),a.global?(r(),y(ie,{key:1,modelValue:a.global,"onUpdate:modelValue":i[7]||(i[7]=C=>a.global=C)},null,8,["modelValue"])):L("",!0)]),_:2},1024),d(R,{name:"title"},{default:s(()=>[B(b(o.title),1)]),_:2},1024),d(R,{name:"due"},{default:s(()=>[B(b(o.due.formatted),1)]),_:2},1024),d(R,{name:"status"},{default:s(()=>[o.status?(r(),y(N,{key:0,design:"success",label:e.$trans("utility.todo.completed")},null,8,["label"])):(r(),y(N,{key:1,design:"error",label:e.$trans("utility.todo.incomplete")},null,8,["label"]))]),_:2},1024),d(R,{name:"completedAt"},{default:s(()=>{var C;return[B(b((C=o.completedAt)==null?void 0:C.formatted),1)]}),_:2},1024),d(R,{name:"statusUpdate"},{default:s(()=>[n("span",Qe,[o.completedAt?S((r(),x("span",et,[n("i",{class:"far fa-times-circle fa-lg text-danger cursor-pointer",onClick:C=>$(o)},null,8,tt)])),[[M,e.$trans("utility.todo.mark_as_incomplete")]]):S((r(),x("span",st,[n("i",{class:"far fa-check-circle fa-lg text-success cursor-pointer",onClick:C=>$(o)},null,8,it)])),[[M,e.$trans("utility.todo.mark_as_complete")]])])]),_:2},1024),d(R,{name:"action"},{default:s(()=>[d(ae,null,{default:s(()=>[o.completedAt&&!o.isArchived?(r(),y(j,{key:0,icon:"fas fa-box-archive",onClick:C=>t(o)},{default:s(()=>[B(b(e.$trans("general.archive")),1)]),_:2},1032,["onClick"])):L("",!0),o.isArchived?(r(),y(j,{key:1,icon:"fas fa-box-open",onClick:C=>p(o)},{default:s(()=>[B(b(e.$trans("general.unarchive")),1)]),_:2},1032,["onClick"])):L("",!0),d(j,{icon:"fas fa-arrow-circle-right",onClick:C=>u(f).push({name:"UtilityTodoShow",params:{uuid:o.uuid}})},{default:s(()=>[B(b(e.$trans("general.show")),1)]),_:2},1032,["onClick"]),d(j,{icon:"fas fa-edit",onClick:C=>u(f).push({name:"UtilityTodoEdit",params:{uuid:o.uuid}})},{default:s(()=>[B(b(e.$trans("general.edit")),1)]),_:2},1032,["onClick"]),d(j,{icon:"fas fa-copy",onClick:C=>u(f).push({name:"UtilityTodoDuplicate",params:{uuid:o.uuid}})},{default:s(()=>[B(b(e.$trans("general.duplicate")),1)]),_:2},1032,["onClick"]),d(j,{icon:"fas fa-trash",onClick:C=>u(v).emit("deleteItem",{uuid:o.uuid})},{default:s(()=>[B(b(e.$trans("general.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["selected","header","meta"])]),_:1})):L("",!0),u(m).query.view=="board"?(r(),y(V,{key:1,appear:"",visibility:!0},{default:s(()=>[w.meta?(r(),y(He,{key:0,"is-loading":q.value,todos:w,"pre-requisites":c,onNewListAdded:U},null,8,["is-loading","todos","pre-requisites"])):L("",!0)]),_:1})):L("",!0)]),_:1})}}});export{lt as default};
