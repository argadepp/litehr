import{c as N,N as ae,u as I,q as J,t as w,s as K,v as Q,r as c,o as d,k as F,l as n,d as s,e as m,x as g,y as a,b as S,f as l,m as ne,h as re,z as G,a as D,F as U,A,L as oe}from"./app-44623493.js";function W(p="USD"){let u=N(()=>ae.getters["config/config"]("system.currencies")).value.find(V=>V.name==p);return u===void 0?{decimal:2,position:"prefix"}:u}function E(p=0,r="USD"){let u=W(r);return se(p,u.decimal||2)}function T(p=0,r="USD"){let u=W(r);return p=E(p,r),u.position==="prefix"?u.symbol+""+p:p+" "+u.symbol}function se(p,r){r=Math.abs(parseInt(r))||0;var u=Math.pow(10,r);return Math.round(p*u)/u}const le={class:"grid grid-cols-3 gap-6"},ue={class:"col-span-3 sm:col-span-1"},ie={class:"col-span-3 sm:col-span-1"},de={__name:"FilterGenerate",props:{initUrl:{type:String,default:""}},emits:["hide"],setup(p,{emit:r}){const u=p,V=I();J("moment");const B={employee:"",startDate:"",endDate:""},y=w({...B}),b=K(u.initUrl),v=w({employee:"",isLoaded:!V.query.employee});return Q(async()=>{v.employee=V.query.employee,v.isLoaded=!0}),(P,f)=>{const q=c("BaseSelectSearch"),L=c("DatePicker"),$=c("FilterForm");return d(),F($,{"init-form":B,form:y,onHide:f[5]||(f[5]=t=>r("hide"))},{default:n(()=>[s("div",le,[s("div",ue,[v.isLoaded?(d(),F(q,{key:0,name:"employee",label:P.$trans("global.select",{attribute:P.$trans("employee.employee")}),modelValue:y.employee,"onUpdate:modelValue":f[0]||(f[0]=t=>y.employee=t),"value-prop":"uuid","init-search":v.employee,"additional-search-query":{self:0},"search-action":"employee/list",error:m(b).employee,"onUpdate:error":f[1]||(f[1]=t=>m(b).employee=t)},{selectedOption:n(t=>[g(a(t.value.name)+" ("+a(t.value.codeNumber)+") ",1)]),listOption:n(t=>[g(a(t.option.name)+" ("+a(t.option.codeNumber)+") ",1)]),_:1},8,["label","modelValue","init-search","error"])):S("",!0)]),s("div",ie,[l(L,{start:y.startDate,"onUpdate:start":f[2]||(f[2]=t=>y.startDate=t),end:y.endDate,"onUpdate:end":f[3]||(f[3]=t=>y.endDate=t),name:"dateBetween",as:"range",label:P.$trans("payroll.props.period"),error:m(b).startDate,"onUpdate:error":f[4]||(f[4]=t=>m(b).startDate=t)},null,8,["start","end","label","error"])])])]),_:1},8,["form"])}}},ce={class:"font-semibold"},me={class:"space-y-4"},pe={class:"grid grid-cols-2 gap-4"},ye={class:"col-span-2 space-y-4 sm:col-span-1"},fe={class:"col-span-2 space-y-4 sm:col-span-1"},_e={class:"col-span-2 sm:col-span-1"},ge={class:"text-success flex justify-between text-lg font-semibold"},be={class:"col-span-2 sm:col-span-1"},ve={class:"text-danger flex justify-between text-lg font-semibold"},he={class:"col-span-2 sm:col-span-1"},$e={class:"text-success flex justify-between text-xl font-semibold"},De={class:"mt-4 grid grid-cols-2 gap-3"},Ve={class:"col-span-3"},ke={name:"PayrollForm"},He=Object.assign(ke,{setup(p){const r=I(),u=ne(),V=re(),B=J("emitter"),y={records:[],remarks:""},b="payroll/",v=K(b),P=N(()=>{let e=0;return h.records.filter(i=>i.payHead.category=="earning").forEach(i=>{e+=E(i.amount)}),T(e)}),f=N(()=>{let e=0;return h.records.filter(i=>i.payHead.category=="deduction").forEach(i=>{e+=E(i.amount)}),T(e)}),q=N(()=>{let e=0;return h.records.forEach(i=>{i.payHead.category=="earning"?e+=E(i.amount):e-=E(i.amount)}),T(e)}),L=G(!1),$=G(!1),t=w({}),h=w({...y}),M=async()=>{$.value=!1,L.value=!0,await V.dispatch(b+"fetchDetail",{params:r.query}).then(e=>{Object.assign(t,{attendanceSummary:e.attendanceSummary,netEarning:e.netEarning.value,netDeduction:e.netDeduction.value,netSalary:e.netSalary.value}),Object.assign(h,{records:e.records}),L.value=!1,$.value=!0}).catch(e=>{L.value=!1})},X=e=>{var j;Object.assign(t,{codeNumber:e.codeNumber,employee:e.employee,period:e.period,attendanceSummary:e.attendanceSummary,netEarning:e.netEarning.value,netDeduction:e.netDeduction.value,netSalary:e.netSalary.value});let i=e.records.map(_=>{let C={uuid:_.payHead.uuid,name:_.payHead.name,category:_.payHead.category.value};return{uuid:_.uuid,payHead:C,amount:_.amount.value}});Object.assign(y,{records:i,remarks:e.remarks}),Object.assign(h,oe(y)),u.push({name:r.name,query:{employee:(j=e.employee)==null?void 0:j.uuid,startDate:e.startDate.value,endDate:e.endDate.value}})},Y=()=>{$.value=!1},Z=()=>{$.value=!1,B.emit("resetFilter")};return Q(async()=>{if(r.params.uuid){$.value=!0;return}r.query.employee&&r.query.startDate&&r.query.endDate&&await M()}),(e,i)=>{const j=c("ParentTransition"),_=c("ListItemView"),C=c("ListContainerVertical"),O=c("BaseCard"),R=c("BaseLabel"),z=c("BaseInput"),x=c("BaseTextarea"),ee=c("FormAction"),te=c("DetailLayoutVertical");return d(),D(U,null,[l(j,{appear:"",visibility:!0},{default:n(()=>[m(r).params.uuid?S("",!0):(d(),F(de,{key:0,onAfterFilter:M,"init-url":b}))]),_:1}),$.value?(d(),F(te,{key:0},{detail:n(()=>[m(r).params.uuid&&t.codeNumber?(d(),F(O,{key:0,"no-padding":"","no-content-padding":""},{title:n(()=>[g(a(e.$trans("payroll.props.code_number"))+" "+a(t.codeNumber),1)]),default:n(()=>[l(C,null,{default:n(()=>[l(_,{label:e.$trans("employee.employee")},{default:n(()=>[g(a(t.employee.name),1)]),_:1},8,["label"]),l(_,{label:e.$trans("company.department.department")},{default:n(()=>[g(a(t.employee.department),1)]),_:1},8,["label"]),l(_,{label:e.$trans("company.designation.designation")},{default:n(()=>[g(a(t.employee.designation),1)]),_:1},8,["label"]),l(_,{label:e.$trans("company.branch.branch")},{default:n(()=>[g(a(t.employee.branch),1)]),_:1},8,["label"]),l(_,{label:e.$trans("employee.employment_status.employment_status")},{default:n(()=>[g(a(t.employee.employmentStatus),1)]),_:1},8,["label"]),l(_,{label:e.$trans("payroll.props.period")},{default:n(()=>[s("span",ce,a(t.period),1)]),_:1},8,["label"])]),_:1})]),_:1})):S("",!0),l(O,{"no-padding":"","no-content-padding":""},{title:n(()=>[g(a(e.$trans("global.summary",{attribute:e.$trans("attendance.attendance")})),1)]),default:n(()=>[l(C,null,{default:n(()=>[(d(!0),D(U,null,A(t.attendanceSummary,o=>(d(),F(_,{align:"right",label:o.name+" ("+o.code+")"},{default:n(()=>[g(a(o.count)+" "+a(e.$trans("list.durations."+o.unit)),1)]),_:2},1032,["label"]))),256))]),_:1})]),_:1})]),default:n(()=>[s("div",me,[$.value?(d(),F(O,{key:0,"is-loading":L.value},{default:n(()=>[l(ee,{"no-card":"","init-url":b,action:m(r).params.uuid?"edit":"generate","init-form":y,form:h,"set-form":X,"after-reset":Y,redirect:"Payroll",onCompleted:Z},{default:n(()=>[s("div",pe,[s("div",ye,[(d(!0),D(U,null,A(h.records,(o,k)=>(d(),D("div",null,[o.payHead.category=="earning"?(d(),D(U,{key:0},[l(R,{class:"text-success"},{default:n(()=>[g(a(o.payHead.name)+" ("+a(o.payHead.code)+")",1)]),_:2},1024),l(z,{currency:"",modelValue:o.amount,"onUpdate:modelValue":H=>o.amount=H,name:`records.${k}.amount`,placeholder:o.payHead.name,error:m(v)[`records.${k}.amount`],"onUpdate:error":H=>m(v)[`records.${k}.amount`]=H},null,8,["modelValue","onUpdate:modelValue","name","placeholder","error","onUpdate:error"])],64)):S("",!0)]))),256))]),s("div",fe,[(d(!0),D(U,null,A(h.records,(o,k)=>(d(),D("div",null,[o.payHead.category=="deduction"?(d(),D(U,{key:0},[l(R,{class:"text-danger"},{default:n(()=>[g(a(o.payHead.name)+" ("+a(o.payHead.code)+")",1)]),_:2},1024),l(z,{currency:"",modelValue:o.amount,"onUpdate:modelValue":H=>o.amount=H,name:`records.${k}.amount`,placeholder:o.payHead.name,error:m(v)[`records.${k}.amount`],"onUpdate:error":H=>m(v)[`records.${k}.amount`]=H},null,8,["modelValue","onUpdate:modelValue","name","placeholder","error","onUpdate:error"])],64)):S("",!0)]))),256))]),s("div",_e,[s("div",ge,[s("span",null,a(e.$trans("payroll.salary_structure.props.net_earning")),1),s("span",null,a(P.value),1)])]),s("div",be,[s("div",ve,[s("span",null,a(e.$trans("payroll.salary_structure.props.net_deduction")),1),s("span",null,a(f.value),1)])]),s("div",he,[s("div",$e,[s("span",null,a(e.$trans("payroll.salary_structure.props.net_salary")),1),s("span",null,a(q.value),1)])])]),s("div",De,[s("div",Ve,[l(x,{modelValue:h.remarks,"onUpdate:modelValue":i[0]||(i[0]=o=>h.remarks=o),name:"remarks",label:e.$trans("payroll.props.remarks"),error:m(v).remarks,"onUpdate:error":i[1]||(i[1]=o=>m(v).remarks=o)},null,8,["modelValue","label","error"])])])]),_:1},8,["action","form"])]),_:1},8,["is-loading"])):S("",!0)])]),_:1})):S("",!0)],64)}}}),Se={name:"PayrollAction"},Fe=Object.assign(Se,{setup(p){const r=I();return(u,V)=>{const B=c("PageHeaderAction"),y=c("PageHeader"),b=c("ParentTransition");return d(),D(U,null,[l(y,{title:u.$trans(m(r).meta.trans,{attribute:u.$trans(m(r).meta.label)}),navs:[{label:u.$trans("payroll.payroll"),path:"Payroll"}]},{default:n(()=>[l(B,{name:"Payroll",title:u.$trans("payroll.payroll"),actions:["list"]},null,8,["title"])]),_:1},8,["title","navs"]),l(b,{appear:"",visibility:!0},{default:n(()=>[l(He)]),_:1})],64)}}});export{Fe as default};
